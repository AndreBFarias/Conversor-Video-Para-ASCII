app-id: com.github.andrebfarias.extase-em-4r73
runtime: org.gnome.Platform
runtime-version: '45'
sdk: org.gnome.Sdk
command: extase-em-4r73

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=all
  - --filesystem=home
  - --filesystem=/tmp
  - --talk-name=org.freedesktop.Notifications

modules:
  - name: python3-numpy
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} numpy
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/65/6e/09db70a523a96d25e115e71cc56a6f9031e7b8cd166c1ac8438307c14058/numpy-1.26.4.tar.gz
        sha256: 2a02aba9ed12e4ac4eb3ea9421c420301a0c6460d9830d74a9df87efa4912010

  - name: python3-opencv
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} opencv-python-headless
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/7e/9e/3b0cf6d2eeafcbac9bd0d7db823c2ba7d3de6f7a45c6939b3cb8df1f0c39/opencv_python_headless-4.10.0.84-cp37-abi3-manylinux_2_17_x86_64.manylinux2014_x86_64.whl
        sha256: 062f0be060b05a9a001c4ddd2cbdb50e4a8c1b567a4eda7610d6e9864fe38f48

  - name: extase-em-4r73
    buildsystem: simple
    build-commands:
      - mkdir -p /app/share/extase-em-4r73
      - cp -r src /app/share/extase-em-4r73/
      - cp main.py /app/share/extase-em-4r73/
      - cp config.ini /app/share/extase-em-4r73/
      - cp -r assets /app/share/extase-em-4r73/
      - mkdir -p /app/share/extase-em-4r73/data_input
      - mkdir -p /app/share/extase-em-4r73/data_output
      - mkdir -p /app/share/extase-em-4r73/logs
      - install -Dm644 assets/logo.png /app/share/icons/hicolor/64x64/apps/com.github.andrebfarias.extase-em-4r73.png
      - install -Dm644 packaging/com.github.andrebfarias.extase-em-4r73.desktop /app/share/applications/com.github.andrebfarias.extase-em-4r73.desktop
      - install -Dm644 packaging/com.github.andrebfarias.extase-em-4r73.metainfo.xml /app/share/metainfo/com.github.andrebfarias.extase-em-4r73.metainfo.xml
      - |
        cat > /app/bin/extase-em-4r73 << 'EOF'
        #!/bin/bash
        cd /app/share/extase-em-4r73
        exec python3 main.py "$@"
        EOF
      - chmod +x /app/bin/extase-em-4r73
    sources:
      - type: dir
        path: ..
